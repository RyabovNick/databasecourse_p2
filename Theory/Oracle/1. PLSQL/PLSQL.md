1. Что такое?
2. Зачем нужен?
3. Из чего состоит?
4. Простейший блок
5. Объявление и использование переменных
6. Вывод сообщений на экран
7. Использование условий
8. Использование циклов (loop, for, while)

# Что такое?

**PL/SQL** – "Programming Language for SQL", или "Procedured SQL" – процедурный SQL. Был создан компанией Oracle с целью расширения стандартного языка SQL. Предназначен для создания более сложных бизнес-правил (ограничения, процедуры, функции и триггеры), также возможно использование переменных, операторов, массивов, курсоров, исключений на стороне сервера ORACLE. 

Блок PL/SQL состоит из четырех секций:

 	- секция заголовка (header section) 
 	- секция объявления (declaration section) 
 	- выполняемой секции (execution section) 
 	- секция исключений (exception section) 
	
```
 	DECLARE
 	-- Описания блока, переменные, типы, курсоры и т. п. (опционально)
 	BEGIN
 	-- Непосредственно код программы
 	EXCEPTION
 	-- Обработка исключений (опционально)
 	END;
 	/* Многострочные
 	комментарии… */
 	-- Однострочный комментарий
```

Из всех секций обязательной является только одна - выполняемая секция. Простейший блок PL/SQL выглядит следующим образом: 

```
BEGIN
dbms_output.put_line('Hello!');
END;
```

Теперь объявим переменную, положим туда какое-то значение и выведем на экран эту переменную.

```
DECLARE
s varchar(50);
BEGIN
s:='Hello!';
dbms_output.put_line(s);
END;
```

Данный блок не имеет заголовка, поэтому он называется ***анонимным***. Только анонимные блоки могут быть вложены друг в друга, они могут использоваться в функциях, процедурах и триггерах. Если базовый блок не имеет заголовка, то есть является анонимным, то он не сохраняется на сервере, а выполняется сразу. Если же базовый блок имеет заголовок, то он хранится на сервере в виде скомпилированной процедуры, функции, пакета или триггера в зависимости от типа заголовка. 

Инициализация может производиться и в секции объявления:

```
DECLARE
s varchar2(50):='Hello';
```

**Секция заголовка**: если она указана, то содержит спецификацию процедуры, функции, пакета или триггера, которая включает в себя название блока, а также описание входных и выходных параметров.

**Секция объявлений**: предназначена для объявления переменных, констант, курсоров, которые будут использоваться в выполняемой секции процедуры, функции или триггера. Секция объявлений расположена сразу после секции заголовка, если она есть, и перед выполняемой секцией. 

В анонимных блоках и в триггерах для создания секции заголовка указывается ключевое слово DECLARE. Во всех остальных случаях ключевое слово DECLARE не используется. 

**Выполняемая секция**: содержит один или более операторов PL/SQL. Эту секцию еще называют телом процедуры, функции или триггера. Выполняемая секция начинается со слова BEGIN и заканчивается словом EXCEPTION, если есть секция исключений, или словом END. 

**Секция исключений**: содержит обработчики исключительных ситуаций. Исключительной ситуацией называют такую ситуацию, когда дальнейшее выполнение выполняемой секции не имеет смысла.

### Преобразование типов

Есть явное или неявное

```
Пример неявного преобразования:
DECLARE
s varchar2(3);
t int;
BEGIN
s:='355';
t:= 10;
dbms_output.put_line(s+t);
END;
```

Явное преобразование может осуществляться при помощи to_char(), to_number()

```
DECLARE
s varchar2(3);
t int;
BEGIN
s:='355';
t:= 10;
dbms_output.put_line(to_number(s)+t);
END;
```

### Условия

**IF:**

```
IF THEN
ELSIF
ELSE
END IF
```

Пример:

```
DECLARE
s varchar2(50);
t int:=0;
BEGIN
IF t = 0 THEN
s:='Hello';
ELSIF t = 1 THEN
s:='Goodbye';
ELSE
s:='Wrong t value';
END IF;
dbms_output.put_line(s);
END;
```

**CASE:**

```
DECLARE
  n number := 2;
BEGIN
	CASE n
	   WHEN 1 THEN dbms_output.put_line('Its 1!!!');
	   WHEN 2 THEN dbms_output.put_line('Its 2!!!');
	   ELSE dbms_output.put_line('It isnt 1 or 2!!!');
	END CASE;
END;
```

### Циклы

Есть 3 типа циклов – loop, for и while.

Из цикла можно выйти следующими способами:
1.	EXIT - Безусловный выход из цикла. Используется посредством применения оператора IF.
2.	EXIT WHEN - Выход при выполнении условия.

```
Пример цикла LOOP. Нахождение числа, квадрат которого больше 100

DECLARE
t int := 0;
BEGIN
LOOP
t:=t+1;
EXIT WHEN (t**2>100);
END LOOP;
dbms_output.put_line(t);
END;
```

```
Цикл while

DECLARE
t int := 0;
BEGIN
While (t**2<=100)
LOOP
t:=t+1;
END LOOP;
dbms_output.put_line(t);
END;
```


```
Цикл for вывод квадрата чисел от 0 до 11. В pl/sql цикл for больше похож на foreach, который удобен для работы с коллекциями в C#.

BEGIN
For i IN 0..11 LOOP
dbms_output.put_line(i**2);
END LOOP;
END;
```

Называть переменные можно используя %TYPE, например

Id students.id%TYPE

Из всех операторов SQL в программах на PL/SQL можно использовать только DML операторы, к ним относятся SELECT, INSERT, UPDATE, DELETE.


