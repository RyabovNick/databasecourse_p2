# API - application programming interface

Представляет собой набор инструментов для создания ПО.

В более общем смысле - это набор чётко определенных способов
связи между различными компонентами.

Существует API для веб-приложения, операционной системы,
базы данных, библиотеки.

В этом материале мы рассматриваем именно веб API.

Веб-API - определенные интерфейсы, через которые происходит
взаимодействие с БД (более частный и простой случай).

Обычно API определяется набором спецификаций, таких как
сообщения запроса протокола HTTP и определение ответных
сообщений (JSON или XML (редко используется в новых проекта,
но может встречается в старых)).

Есть несколько протоколов взаимодействия - SOAP, REST. Первый
уже является несколько устаревшим и в новых проектах используется
REST. Именно он и будет рассмотрен далее.

### HTTP - протокол приложений для распределенных,
совместных и гипермедийных информационных систем.

Протокол HTTP определяет некоторые методы, которые указывают
желаемое действие, которое должно выполняться на ресурсе.

- **GET** - метод должен только извлечь данные
- **POST** - метод запрашивает сервер, чтобы он принял передаваемые данные
- **PUT** - метод изменяет данные на сервере
- **DELETE** - метод удаляет на сервере

Существуют ещё другие методы, но для API понадобятся только эти.

### REST

Representational State Transfer - архитектурный стиль, который определяет
набор ограничений, которые будут использоваться для создания веб-сервисов.

На данный момент цель хорошо познакомиться с REST API не основная задача,
т.к. с БД тут не самое прямое отношение. Поэтому материал, представленный
в данном разделе очень краток.

К REST-приложению есть ряд обязательных ограничений. Одно из главных - это
модель **клиент-сервер**. Отделение клиента от сервера даёт целый ряд
преимуществ. Самое главное - переносимость клиентской части на любые платформы
и языки.

| URL                                  | GET                                        | PUT                                                                      | PATCH                                                                                       | POST                   | DELETE                               |
|--------------------------------------|--------------------------------------------|--------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|------------------------|--------------------------------------|
| https://api.example.com/resources/   | Все сведения о коллекции                   | Заменить всю коллекцию другой коллекцией (используется достаточно редко) | Обычно не используется                                                                      | Создать новый элемент  | Удалить все элементы                 |
| https://api.example.com/resources/17 | Информация о конкретном элементе коллекции | Заменить информацию о конкретном элементе                                | Изменить информацию (чаще для этой задачи используется PUT, а PATCH вообще не используется) | Обычно не используется | Удалить конкретный элемент коллекции |


# Tutorial

### Необходимое ПО:

#### 1. [NodeJs](https://nodejs.org)

**Почему именно он?**

В учебных целях это один из самых простых вариантов для написания собственного API.
Есть большое количество других языков для разработки серверной части - PHP, Python, ASP.NET Core, Go, Ruby.
Внутри практически каждого языка есть множество фреймворков (Python - Django, Flask).

Но для нашей задачи главная цель - невысокий порог вхождения, т.к. мы не можем уделить много времени изучении самого языка в учебной программе, для этого есть другие курсы.
Но никто не мешает заняться дополнительным изучением во внеучебное время и я готов ответить на вопросы, если такой интерес возникнет.

С другой стороны на NodeJS выполнено не мало проектов, он востребован на рынке труда.
Один из самых крупных - [Electron](https://electronjs.org/). На котором сделана в том числе Visual Studio Code (которую я рекомендую тоже поставить, но можете пользоваться и другими IDE).
Кроме того большую популярность в последнее время получили JS-фреймворки - Vue, React, Angular.
И применение в проекте только JavaScript - может быть плюсом.

Но и ещё. Та часть, которая будет рассмотрена на занятиях в принципе идентична на любом языке.
Есть небольшие отличия, да, в синтаксисе. Но никаких глобальных. 

Ruby - немного староват для начала изучений с него.
Go - наоборот, очень молодой.
Python - работа с ним на Windows не самая приятная.
Возможно, если python в универе будет 1-ым или 2-ом языком (у нынешних ПИ перешедших на 2 курс так), то выбрать его - хорошая идея.
ASP.NET Core - тоже достаточно молодая технология. Но для написания конкретно API .NET не самый лучший вариант.
А с PHP вы ещё успеете познакомиться.

#### 2. [Express](https://expressjs.com/)

Очень популярный высокоуровневый фреймворк. 

В подавляющем большинстве случае используется либо он, либо какой-то аналог. 
Делать API на чистом NodeJs придётся маловерятно, поэтому этого не будем делать и мы.
Для не желающих идти по более простому пути можно и пойти по сложному - это не возбраняется. 

#### 3. [npm](https://www.npmjs.com/)

Менеджер пакетов.

Компании и обычные люди могут создавать собственные пакеты и выкладывать их на npm.
Другие пользователи могут скачать их и использовать для собственных нужд.
По сути - это аналог using в C#.

Npm идёт в комплекте с node.js, ничего дополнительно устанавливать не придётся.

Информация, по коду будет ниже.

#### 4. [Visual Studio Code](https://code.visualstudio.com/) или если у вас есть какая-то любимая IDE.

Наличие хорошей IDE с различными дополнениями позволяет серьезно увеличить скорость разработки.
Visual Studio Code - имеет огромное количество встренных расширений, некоторые я советую вам поставить (об этом чуть позже).

#### 5. [Postman](https://www.getpostman.com/) 

Выполнить GET запрос мы можем и в браузере.
Ввести ссылку и получить ответ от сервера.
С PUT, POST, DELETE запросами так не получится.
Можно использовать командную строку, но это не особо удобный вариант.
Postman - позволяет легко выполнить различные API.

#### 6. MySQL Server

Естественно, это курс БД, поэтому СУБД.

Любимый нами Oracle сложноват в установке, да и вообще является более тяжёлой системой.
Поэтому возьмём MySQL. Его легко поставит с оф. сайта

#### 7. MySQL Workbench

Хороший инструмент для визуального проектирования БД, и в целом для взаимодействия с БД.

### Создаём простейший проект

Сделаем папку и откроем Visual Studio Code. Откроем её в IDE.

Откроем терминал путём нажатия ctrl+` (или View - Terminal).

Напишем в терминала `npm init`

Дальше будет задано несколько вопросов, на все можно пока тыкать enter.
До самого конца

```
package name: (nodeapi)
version: (1.0.0)
description:
entry point: (index.js)
test command:
git repository:
keywords:
author:
license: (ISC)
About to write to D:\Projects\unidubnadb\API\NodeAPI\package.json:

{
  "name": "nodeapi",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}


Is this ok? (yes)
```

У вас появился файл package.json в котором содержится вся информация о проекте.

Нам нужен express. Установить его можно написать в терминале

`npm install express`

В итоге появится папка node_modules. 

**Важно!!!**

**В систему контроля версий эта папка никогда не кладётся.
Она может весить много, множество файлов.
Если вы скачали какой-то проект, где есть package.json, то первым в терминале напишите `npm install`.
Все зависимости будут скачаны с npm сервера.**

Создадим файлик server.js

```
var http = require('http');

console.log('Server started');
http.createServer(function (req, res) {
    res.writeHead(200, {'Content-Type': 'text/plain'});
    res.end('My first server!');
}).listen(8080);
```

Напишем в терминале node server.js. Должно появиться сообщение Server started.

Откройте теперь в браузере http://localhost:8080/.

Если получили сообщение "My first server!" то значит всё работает.

**Что происходит в коде?**

Мы подключаем пакет http, который уже сделан хорошими людьми и там есть функция createServer.
функция внутри принимает 2 параметра - req (request), res (response).
**Request** - то, что приходит от пользователя.
**Response** - то, что отправляем обратно.

Мы говорим, что запрос выполнился с кодом 200, т.е. успешно. [HTTP Коды ответов](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes)
А также при помощи `end` отправим сообщение.

listen - указываем какой порт слушать. Кстати, у вас может занят порт 8080, если будет ошибка. Попробуйте другой.
console.log - это просто сообщение в консоль

Остановим сервер путём нажатия ctrl+c в терминале. Добавим туда новый код, сохраним и запустим

`node server.js` ещё раз

```
const express = require('express');
const app = express();

app.listen(8080, () => {
    console.log('Server started!');
});
```

**Что происходит в коде?**

Тут мы подключили наш установленный express.
http тут уже нет, т.к. он часть пакета express.
Ещё тут отличие, что в предыдущем примере Server started! напишет в любом случае.
А тут, только когда сервер запустится.

Перейдём по той же ссылке. И он нам ответит, что GET по / пути не найден.
Давайте исправим.

```
const express = require('express');
const app = express();

app.route('/').get((req, res) => {
    res.send('Hi everyone!');
});

app.listen(8080, () => {
    console.log('Server started!');
});
```

**Что происходит в коде?**

Мы добавили часть, где говорим, что по пути '/', если это get запрос мы хотим вернуть сообщение Hi everyone.

Стоит остановиться на конструкции 

```
(req, res) => {}
```

Она является аналогом

```
function (req, res) {}
```

Более краткая запись. Называется Arrow Function

Снова запустим сервер с изменённым кодом.
Теперь он должен написать 'Hi everyone'.

Мы хотим, чтобы сервер приветствовал каждую группу.

```
const express = require("express");
const app = express();

app.route("/3221").get((req, res) => {
  res.send("Hi group: 3221");
});

app.listen(8080, () => {
  console.log("Server started!");
});
```

Окей, он попривествовал группу 3221. Давайте добавим ещё одну.

```
const express = require("express");
const app = express();

app.route("/3221").get((req, res) => {
  res.send("Hi group: 3221");
});

app.route("/3281").get((req, res) => {
  res.send("Hi group: 3281");
});

app.listen(8080, () => {
  console.log("Server started!");
});
```

А если групп тысяча? Как-то не очень удобно.

Есть другой вариант!

```
const express = require("express");
const app = express();

app.route("/:group").get((req, res) => {
  var group = req.params["group"];
  res.send("Hi group: " + group);
});

app.listen(8080, () => {
  console.log("Server started!");
});
```

**Что происходит в коде?**

В код добавлено "/:group" и если мы перейдём по ссылке http://localhost:8080/:group сервер нам вернёт Hi group: :group.

`:group` - такая запись для параметров.
Дальше в коде мы в переменную group кладём этот параметр и выводим его на экран. Параметров может быть сколько угодно.

Поэксперементируйте. Введите свой номер группы.